/*
All public Holiday calendars [about 250] from Google can be used, for each country, religion or sports.
https://www.vueminder.com/calendars/calendars.xml
https://gist.github.com/dhoeric/76bd1c15168ee0ee61ad3bf1730dcb65
https://calendar.google.com/calendar/u/0/r/settings/browsecalendars
*/
let
    country01 = "usa",
    country02 = "german",
    country03 = "be",
    country04 = "dutch",
    country05 = "uk",
    country06 = "austrian",
    country07 = "canadian",
    country08 = "danish",
    country09 = "eg",
    country10 = "french",
    country11 = "greek",
    country12 = "irish",
    country13 = "indonesian",
    country14 = "jewish",
    country15 = "italian",
    country16 = "japanese",
    country17 = "lu",
    country18 = "ma",
    country19 = "mexican",
    country20 = "portuguese",
    country21 = "polish",
    country22 = "spain",
    country23 = "sa",
    country24 = "ch",
    //only available in english and country languages
    lang = "en",
    Combined = Table.Combine({
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country01&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country01),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country02&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country02),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country03&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country03),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country04&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country04),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country05&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country05),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country06&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country06),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country07&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country07),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country08&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country08),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country09&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country09),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country10&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country10),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country11&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country11),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country12&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country12),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country13&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country13),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country14&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country14),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country15&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country15),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country16&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country16),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country17&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country17),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country18&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country18),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country19&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country19),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country20&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country20),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country21&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country21),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country22&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country22),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country23&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country23),
        Table.AddColumn(Table.Transpose(Table.SplitColumn(Table.FromValue({Text.FromBinary(Web.Contents("https://calendar.google.com/calendar/ical/"&lang&"."&country24&"%23holiday%40group.v.calendar.google.com/public/basic.ics"))}), "Value", Splitter.SplitTextByDelimiter("BEGIN:VEVENT", QuoteStyle.Csv))), "country", each country24)
    }),
    RemoveHeader = Table.SelectRows(Combined, each not Text.Contains([Column1], "BEGIN:VCALENDAR")),
    RemoveNewlines = Table.ReplaceValue(RemoveHeader,"#(cr)#(lf) ","",Replacer.ReplaceText,{"Column1"}),
    Split2 = Table.SplitColumn(RemoveNewlines, "Column1", Splitter.SplitTextByDelimiter("#(cr)#(lf)", QuoteStyle.Csv)),
    Index = Table.AddIndexColumn(Split2, "Index", 1, 1, Int64.Type),
    UnPivot = Table.UnpivotOtherColumns(Index, {"Index", "country"}, "Name", "Value"),
    RemoveColumn = Table.RemoveColumns(UnPivot,{"Name"}),
    Split3 = Table.SplitColumn(RemoveColumn, "Value", Splitter.SplitTextByEachDelimiter({":"}, QuoteStyle.Csv, false), {"Name", "Value"}),
    Filter = Table.SelectRows(Split3, each ([Value] <> null) and ([Name] = "DESCRIPTION" or [Name] = "DTSTART;VALUE=DATE" or [Name] = "SUMMARY")),
    Pivot = Table.Pivot(Filter, List.Distinct(Filter[Name]), "Name", "Value"),
    Names = Table.RenameColumns(Pivot,{{"SUMMARY", "Holiday"}, {"DTSTART;VALUE=DATE", "Date"}}),
    DateType = Table.TransformColumnTypes(Names,{{"Date", type date}}),
    RemoveIndex = Table.RemoveColumns(DateType,{"Index"}),
    Sort = Table.Sort(RemoveIndex,{{"Date", Order.Ascending}}),
    #"Replace\" = Table.ReplaceValue(Sort,"\,",",",Replacer.ReplaceText,{"DESCRIPTION"}),
    #"Replace\n" = Table.ReplaceValue(#"Replace\","\n","#(cr)#(lf)",Replacer.ReplaceText,{"DESCRIPTION"}),
    #"Replace-be" = Table.ReplaceValue(#"Replace\n","be","belgian",Replacer.ReplaceValue,{"country"}),
    #"Replace-jewish" = Table.ReplaceValue(#"Replace-be","jewish","israeli",Replacer.ReplaceValue,{"country"}),
    #"Replace-lu" = Table.ReplaceValue(#"Replace-jewish","lu","luxembourgish",Replacer.ReplaceValue,{"country"}),
    #"Replace-ch" = Table.ReplaceValue(#"Replace-lu","ch","swiss",Replacer.ReplaceValue,{"country"}),
    #"Replace-sa" = Table.ReplaceValue(#"Replace-ch","sa","south-african",Replacer.ReplaceValue,{"country"}),
    #"Replace-eg" = Table.ReplaceValue(#"Replace-sa","eg","egyptian",Replacer.ReplaceValue,{"country"}),
    #"Replace-ma" = Table.ReplaceValue(#"Replace-eg","ma","maroccan",Replacer.ReplaceValue,{"country"}),
    #"Replace-spain" = Table.ReplaceValue(#"Replace-ma","spain","spanish",Replacer.ReplaceValue,{"country"})
in
    #"Replace-spain"